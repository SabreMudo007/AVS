<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="Imagens/AVS-logo.png">
<link rel="stylesheet" href="Estilos.css">
<title>AVS - Doar</title>
</head>
<body class="body-doar">

<nav>
  <ul class="list-menu">
    <li> <a href="index.html"><img src="Imagens/AVS-logo.png" alt="AVS" height="5" width="5"> </a></li>
    <li><a href="index.html">Inicio</a></li>
    <li><a href="Eventos.html">Eventos</a></li>
    <li><a href="Doar.html">Doar</a></li>
    <li><a href="Sobre.html">Sobre nós</a></li>
    <li><a href="Join.html">Junte-se às equipas</a></li>
    <li><a href="#" id="contaLink">Conta</a></li>
  </ul>
</nav>

<section class="hero">
  <img class="logo" src="/Imagens/AVS-logo.png" alt="AVS">
  <h1 class="titulo">Juntos Fazemos a Mudança</h1>
</section>

<section class="formulario-doar">
<h2>Faça a sua doação</h2>
<p>Com a sua contribuição, ajudamos quem mais precisa. Cada gesto conta!</p>

<form class="doacao-form" id="doacaoForm">
  <label for="nome">Nome completo</label>
  <input type="text" id="nome" name="nome" placeholder="Digite o seu nome" required>

  <label for="email">E-mail</label>
  <input type="email" id="email" name="email" placeholder="Digite o seu e-mail" required>

  <label for="valor">Valor da doação (€)</label>
  <input type="number" id="valor" name="valor" min="1" placeholder="Ex: 20" required>

  <label for="mensagem">Mensagem (opcional)</label>
  <textarea id="mensagem" name="mensagem" rows="4" placeholder="Deixe uma mensagem solidária..."></textarea>

  <button type="submit">Doar Agora</button>
</form>
</section>

<footer>
  <p>2025 Associação de Voluntariado de Setúbal.</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBIE36QlivTvwqx6fjEV2EVAK2gN7dRdrs",
  authDomain: "avs-login-b3345.firebaseapp.com",
  projectId: "avs-login-b3345",
  storageBucket: "avs-login-b3345.firebasestorage.app",
  messagingSenderId: "441342978542",
  appId: "1:441342978542:web:884bc7280c4db0c6bdc6ff"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let userLogged = null; 

// Estado de autenticação
onAuthStateChanged(auth, (user) => {
  userLogged = user;
});

// Link para a conta
document.getElementById("contaLink").addEventListener("click", (e) => {
  e.preventDefault();
  window.location.href = userLogged ? "Logado.html" : "Conta.html";
});

// Submissão do formulário de doação
document.getElementById("doacaoForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!userLogged) {
    alert("Precisa de estar autenticado para doar.");
    return;
  }

  try { // regista a doação no Firestore
    await addDoc(collection(db, "doacoes"), { // guarda na coleção "doacoes" do Firestore
      uid: userLogged.uid, // UID do utilizador
      valor: Number(document.getElementById("valor").value), // valor da doação
      mensagem: document.getElementById("mensagem").value || "—", // mensagem ou "—" se estiver vazia
      estado: "concluida", // estado da doação
      data: serverTimestamp() // timestamp do servidor
    }); // cada doação é um novo documento na coleção, que tem que ter os campos acima

    alert("Doação registada com sucesso!"); // notifica o utilizador do sucesso
    e.target.reset(); // limpa o formulário

  } catch (error) { // em caso de erro
    console.error(error); 
    alert("Erro ao registar doação.");
  }
});
</script>

</body>
</html>

