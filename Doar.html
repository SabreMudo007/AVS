<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<title>AVS - Doar</title>
<link rel="stylesheet" href="Estilos.css" />
</head>
<body class="body-doar">

<nav>
  <ul class="list-menu">
    <li><img src="AVS-logo.png" alt="Reflorestamento" height="5px" width="5px" /></li>
    <li><a href="Home.html">Inicio</a></li>
    <li><a href="Eventos.html">Eventos</a></li>
    <li><a href="Doar.html">Doar</a></li>
    <li><a href="Sobre.html">Sobre n√≥s</a></li>
    <li><a href="Join.html">Junte-se √†s equipas</a></li>
    <li><a href="#" id="contaLink">Conta</a></li>
  </ul>
</nav>

<section class="hero">
  <img class="logo" src="AVS-logo.png" alt="Logotipo AVS" />
  <h1 class="titulo">Juntos Fazemos a Mudan√ßa</h1>
</section>

<section class="formulario-doar">
<h2>Fa√ßa a sua doa√ß√£o</h2>
<p>Com a sua contribui√ß√£o, ajudamos quem mais precisa. Cada gesto conta!</p>

<form class="doacao-form" id="doacaoForm">
  <label for="nome">Nome completo</label>
  <input type="text" id="nome" name="nome" placeholder="Digite o seu nome" required />

  <label for="email">E-mail</label>
  <input type="email" id="email" name="email" placeholder="Digite o seu e-mail" required />

  <label for="valor">Valor da doa√ß√£o (‚Ç¨)</label>
  <input type="number" id="valor" name="valor" min="1" placeholder="Ex: 20" required />

  <label for="mensagem">Mensagem (opcional)</label>
  <textarea id="mensagem" name="mensagem" rows="4" placeholder="Deixe uma mensagem solid√°ria..."></textarea>

  <button type="submit">Doar Agora</button>
</form>
</section>

<footer>
  <p>2025 Associa√ß√£o de Voluntariado de Set√∫bal.</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// üîπ Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBIE36QlivTvwqx6fjEV2EVAK2gN7dRdrs",
  authDomain: "avs-login-b3345.firebaseapp.com",
  projectId: "avs-login-b3345",
  storageBucket: "avs-login-b3345.firebasestorage.app",
  messagingSenderId: "441342978542",
  appId: "1:441342978542:web:884bc7280c4db0c6bdc6ff"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let userLogged = null; 

// üîπ Estado de autentica√ß√£o
onAuthStateChanged(auth, (user) => {
  userLogged = user;
});

// üîπ Link para a conta
document.getElementById("contaLink").addEventListener("click", (e) => {
  e.preventDefault();
  window.location.href = userLogged ? "Logado.html" : "Conta.html";
});

// üîπ Submiss√£o do formul√°rio de doa√ß√£o
document.getElementById("doacaoForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!userLogged) {
    alert("Precisa de estar autenticado para doar.");
    return;
  }

  try { // regista a doa√ß√£o no Firestore
    await addDoc(collection(db, "doacoes"), { // guarda na cole√ß√£o "doacoes" do Firestore
      uid: userLogged.uid, // UID do utilizador
      valor: Number(document.getElementById("valor").value), // valor da doa√ß√£o
      mensagem: document.getElementById("mensagem").value || "‚Äî", // mensagem ou "‚Äî" se estiver vazia
      estado: "concluida", // estado da doa√ß√£o
      data: serverTimestamp() // timestamp do servidor
    }); // cada doa√ß√£o √© um novo documento na cole√ß√£o, que tem que ter os campos acima

    alert("Doa√ß√£o registada com sucesso!"); // notifica o utilizador do sucesso
    e.target.reset(); // limpa o formul√°rio

  } catch (error) { // em caso de erro
    console.error(error); 
    alert("Erro ao registar doa√ß√£o.");
  }
});
</script>

</body>
</html>

